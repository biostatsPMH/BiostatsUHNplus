<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.4 Bayesian hierarchical model | Example nested summary and Bayesian hierarchical model summary</title>
  <meta name="description" content="3.4 Bayesian hierarchical model | Example nested summary and Bayesian hierarchical model summary" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="3.4 Bayesian hierarchical model | Example nested summary and Bayesian hierarchical model summary" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.4 Bayesian hierarchical model | Example nested summary and Bayesian hierarchical model summary" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="generalized-estimating-equations-model.html"/>
<link rel="next" href="biostatsuhnplus.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li> &nbsp;&nbsp; BiostatsUHNplus    </li>
<li> &nbsp;&nbsp; Biostatistics@UHN</li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="exploratory-analysis.html"><a href="exploratory-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="summary-of-high-protein-status.html"><a href="summary-of-high-protein-status.html"><i class="fa fa-check"></i><b>2.1</b> Summary of high protein status</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="summary-of-high-protein-status.html"><a href="summary-of-high-protein-status.html#by-data-record-row"><i class="fa fa-check"></i><b>2.1.1</b> By data record (row):</a></li>
<li class="chapter" data-level="2.1.2" data-path="summary-of-high-protein-status.html"><a href="summary-of-high-protein-status.html#by-cow-in-yard-at-observation-instance"><i class="fa fa-check"></i><b>2.1.2</b> By cow in yard at observation instance:</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="nested-summary-of-high-protein-status.html"><a href="nested-summary-of-high-protein-status.html"><i class="fa fa-check"></i><b>2.2</b> Nested summary of high protein status</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="nested-summary-of-high-protein-status.html"><a href="nested-summary-of-high-protein-status.html#by-cow"><i class="fa fa-check"></i><b>2.2.1</b> By cow:</a></li>
<li class="chapter" data-level="2.2.2" data-path="nested-summary-of-high-protein-status.html"><a href="nested-summary-of-high-protein-status.html#by-cow-nested-in-yard"><i class="fa fa-check"></i><b>2.2.2</b> By cow nested in yard:</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="nested-summary-of-yard.html"><a href="nested-summary-of-yard.html"><i class="fa fa-check"></i><b>2.3</b> Nested summary of yard</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="nested-summary-of-yard.html"><a href="nested-summary-of-yard.html#by-cow-1"><i class="fa fa-check"></i><b>2.3.1</b> By cow:</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="nested-summary-of-diet.html"><a href="nested-summary-of-diet.html"><i class="fa fa-check"></i><b>2.4</b> Nested summary of diet</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="nested-summary-of-diet.html"><a href="nested-summary-of-diet.html#by-cow-2"><i class="fa fa-check"></i><b>2.4.1</b> By cow:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="inferential-analysis.html"><a href="inferential-analysis.html"><i class="fa fa-check"></i><b>3</b> Inferential analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="kaplan-meier-survival-curve.html"><a href="kaplan-meier-survival-curve.html"><i class="fa fa-check"></i><b>3.1</b> Kaplan-Meier survival curve</a></li>
<li class="chapter" data-level="3.2" data-path="logistic-model.html"><a href="logistic-model.html"><i class="fa fa-check"></i><b>3.2</b> Logistic model</a></li>
<li class="chapter" data-level="3.3" data-path="generalized-estimating-equations-model.html"><a href="generalized-estimating-equations-model.html"><i class="fa fa-check"></i><b>3.3</b> Generalized estimating equations model</a></li>
<li class="chapter" data-level="3.4" data-path="bayesian-hierarchical-model.html"><a href="bayesian-hierarchical-model.html"><i class="fa fa-check"></i><b>3.4</b> Bayesian hierarchical model</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="bayesian-hierarchical-model.html"><a href="bayesian-hierarchical-model.html#variance-piechart"><i class="fa fa-check"></i><b>3.4.1</b> Variance piechart</a></li>
<li class="chapter" data-level="3.4.2" data-path="bayesian-hierarchical-model.html"><a href="bayesian-hierarchical-model.html#caterpillar-plot-for-random-effect-of-cow"><i class="fa fa-check"></i><b>3.4.2</b> Caterpillar plot for random effect of cow</a></li>
<li class="chapter" data-level="3.4.3" data-path="bayesian-hierarchical-model.html"><a href="bayesian-hierarchical-model.html#caterpillar-plot-for-random-effect-of-yard"><i class="fa fa-check"></i><b>3.4.3</b> Caterpillar plot for random effect of yard</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="biostatsuhnplus.html"><a href="biostatsuhnplus.html"><i class="fa fa-check"></i><b>4</b> BiostatsUHNplus</a>
<ul>
<li class="chapter" data-level="4.1" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>4.1</b> Installation</a></li>
<li class="chapter" data-level="4.2" data-path="documentation.html"><a href="documentation.html"><i class="fa fa-check"></i><b>4.2</b> Documentation</a></li>
<li class="chapter" data-level="4.3" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>4.3</b> Examples</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="examples.html"><a href="examples.html#a-wrapper-for-the-as.numeric-function.-prints-entries-that-fail-to-parse-instead-of-throwing-uninformative-error"><i class="fa fa-check"></i><b>4.3.1</b> A wrapper for the as.numeric function. Prints entries that fail to parse instead of throwing uninformative error</a></li>
<li class="chapter" data-level="4.3.2" data-path="examples.html"><a href="examples.html#nested-summary-of-adverse-events-by-participant-in-cohort-stratified-by-attribution-to-first-study-drug"><i class="fa fa-check"></i><b>4.3.2</b> Nested summary of adverse events by participant in cohort, stratified by attribution to first study drug</a></li>
<li class="chapter" data-level="4.3.3" data-path="examples.html"><a href="examples.html#outputs-three-dsmb-ccru-ae-summary-tables-in-excel-format-per-uhn-template"><i class="fa fa-check"></i><b>4.3.3</b> Outputs three DSMB-CCRU AE summary tables in Excel format per UHN template</a></li>
<li class="chapter" data-level="4.3.4" data-path="examples.html"><a href="examples.html#related-adverse-event-onset-timeline-plots"><i class="fa fa-check"></i><b>4.3.4</b> Related adverse event onset timeline plots</a></li>
<li class="chapter" data-level="4.3.5" data-path="examples.html"><a href="examples.html#summary-functions-for-mcmcglmm-object-with-binary-outcome"><i class="fa fa-check"></i><b>4.3.5</b> Summary functions for MCMCglmm object with binary outcome</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Example nested summary and Bayesian hierarchical model summary</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-hierarchical-model" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Bayesian hierarchical model<a href="bayesian-hierarchical-model.html#bayesian-hierarchical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below runs a logistic MCMCglmm model treating cow and yard as random effects for 800 posterior samples. Should specify burnin=125000, nitt=625000 and thin=100 for 5000 posterior samples with lower autocorrelation. Aim for effective sample sizes of at least 2000.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="bayesian-hierarchical-model.html#cb14-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(HP <span class="sc">~</span> Diet <span class="sc">+</span> Time, <span class="at">random=</span><span class="sc">~</span>Cow <span class="sc">+</span> Yard, <span class="at">family=</span><span class="st">&quot;categorical&quot;</span>, <span class="at">data=</span>Milk, <span class="at">saveX=</span><span class="cn">TRUE</span>, <span class="at">verbose=</span>F, <span class="at">burnin=</span><span class="dv">2000</span>, <span class="at">nitt=</span><span class="dv">10000</span>, <span class="at">thin=</span><span class="dv">10</span>, <span class="at">pr=</span><span class="cn">TRUE</span>, <span class="at">prior=</span>prior2RE);</span>
<span id="cb14-2"><a href="bayesian-hierarchical-model.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="bayesian-hierarchical-model.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#autocorr.diag(model1$VCV); #use this to choose thinning interval, autocorrelation less than 0.01 ideally;</span></span>
<span id="cb14-4"><a href="bayesian-hierarchical-model.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="bayesian-hierarchical-model.html#cb14-5" aria-hidden="true" tabindex="-1"></a>mcmcglmm_mva <span class="ot">&lt;-</span> <span class="fu">nice_mcmcglmm</span>(model1, Milk);</span>
<span id="cb14-6"><a href="bayesian-hierarchical-model.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>);</span>
<span id="cb14-7"><a href="bayesian-hierarchical-model.html#cb14-7" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mcmcglmm_mva);</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Levels
</th>
<th style="text-align:left;">
OR (95% HPDI)
</th>
<th style="text-align:left;">
MCMCp
</th>
<th style="text-align:left;">
eff.samp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Diet
</td>
<td style="text-align:left;">
barley
</td>
<td style="text-align:left;">
reference
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
barley+lupins
</td>
<td style="text-align:left;">
0.36 (0.17, 0.78)
</td>
<td style="text-align:left;">
0.010
</td>
<td style="text-align:left;">
704.06
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
lupins
</td>
<td style="text-align:left;">
0.19 (0.08, 0.47)
</td>
<td style="text-align:left;">
0.001
</td>
<td style="text-align:left;">
441.32
</td>
</tr>
<tr>
<td style="text-align:left;">
Time
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
0.96 (0.93, 0.99)
</td>
<td style="text-align:left;">
0.007
</td>
<td style="text-align:left;">
233.31
</td>
</tr>
</tbody>
</table>
<p>Random effects ICC and 95% highest posterior density interval:</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
ICC
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Cow
</td>
<td style="text-align:right;">
0.6343
</td>
<td style="text-align:right;">
0.5130
</td>
<td style="text-align:right;">
0.7554
</td>
</tr>
<tr>
<td style="text-align:left;">
Yard
</td>
<td style="text-align:right;">
0.0028
</td>
<td style="text-align:right;">
0.0007
</td>
<td style="text-align:right;">
0.0980
</td>
</tr>
<tr>
<td style="text-align:left;">
units
</td>
<td style="text-align:right;">
0.3175
</td>
<td style="text-align:right;">
0.2367
</td>
<td style="text-align:right;">
0.4589
</td>
</tr>
</tbody>
</table>
<p>R-squared calculation with 95% credible intervals for marginal model - considers only the variance of the fixed effects (without the random effects):</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
R_Squared
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.1538995
</td>
<td style="text-align:right;">
0.0421643
</td>
<td style="text-align:right;">
0.2661703
</td>
</tr>
</tbody>
</table>
<p>R-squared calculation with 95% credible intervals for conditional model - takes both the fixed and random effects into account:</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
R_Squared
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.7043503
</td>
<td style="text-align:right;">
0.6252562
</td>
<td style="text-align:right;">
0.8051031
</td>
</tr>
</tbody>
</table>
<div id="variance-piechart" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Variance piechart<a href="bayesian-hierarchical-model.html#variance-piechart" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="man/figures/variance_pie_plot.png" width="100%" /></p>
</div>
<div id="caterpillar-plot-for-random-effect-of-cow" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Caterpillar plot for random effect of cow<a href="bayesian-hierarchical-model.html#caterpillar-plot-for-random-effect-of-cow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Odds ratio of high protein milk among cows is below. Highest posterior density intervals are not necessarily symmetric, but should be close to symmetric upon running more model iterations. Note that cows L23 and L27 have a higher odds estimate for high protein milk in random effect, even though those cows were fed a diet of lupins and should in theory have lower protein milk. Cow B01 also has higher odds of high protein milk, but was always fed a better diet (barley).</p>
<p><img src="man/figures/caterpillar_plot_Cows_Model.png" width="100%" /></p>
</div>
<div id="caterpillar-plot-for-random-effect-of-yard" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Caterpillar plot for random effect of yard<a href="bayesian-hierarchical-model.html#caterpillar-plot-for-random-effect-of-yard" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Odds ratio of high protein milk among yards is below. Highest posterior density intervals are not necessarily symmetric.</p>
<p><img src="man/figures/caterpillar_plot_Yards_Model.png" width="100%" /></p>

<!-- This file is used to create README.md
Note that the README.md document may need updating to change
'\<0.001' to '<0.001'. 
-->
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="generalized-estimating-equations-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="biostatsuhnplus.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none",
"toc_depth": 3,
"scroll_highlight": true
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
